install_missing_pkgs <- function(pkgs) {
to_install <- setdiff(pkgs, installed.packages()) #identify what to install
if (!requireNamespace("BiocManager", quietly = TRUE, dependencies = TRUE)) {
install.packages("BiocManager", repos = "https://cloud.r-project.org")
}
cran_catalog <- rownames(available.packages())
#bioc_catalog <- BiocManager::available() not needed as cran is smaller
is_cran <- to_install %in% cran_catalog
#is_bioc <- to_install %in% bioc_catalog not needed as cran is smaller
cran_pkgs <- to_install[is_cran]
bioc_pkgs <- setdiff(to_install, cran_pkgs)
if(length(cran_pkgs)){
install.packages(cran_pkgs, quiet = TRUE)
message("Installing packages: ", paste(to_install, collapse = ", "))
} else {
message("All CRAN packages already installed.")
}
if(length(bioc_pkgs)){
BiocManager::install(bioc_pkgs, quietly = TRUE, dependencies = TRUE)
message("Installing packages: ", paste(to_install, collapse = ", "))
} else {
message("All bioconductor packages already installed.")
}
load_pkgs <- sapply(pkgs, require, character.only = TRUE, quietly = TRUE)
load_fail <- names(load_pkgs)[!load_pkgs]
if(length(load_fail)) {
message("Some packages failed to load: ", paste(load_fail, collapse = ", "))
}else{
return("All packages loaded successfully.")
}
}
install_missing_pkgs(pkgs)
set.seed(12345)
library("WGCNA")
pkgs <- c(
"tidyverse",     # Contains multiple packages for general tidiness
"magrittr",      # Pipe-friendly helpers
"dtplyr",        # data.table backend for dplyr
"textshaping",   # Text shaping for graphics devices
"impute",
"preprocessCore",
"WGCNA",         # Weighted Gene Coexpression Network Analysis
"RColorBrewer",  # Color palettes
"ggplot2",       # Plotting (also in tidyverse)
"pheatmap",      # Heatmaps
"ggrepel",       # Text repel
"svglite",       # Save SVGs
"GOplot",        # GO chord plotting
"patchwork",      # Combine ggplots
"DESeq2",          # Differential Expression Analysis
"GO.db",           # Human gene annotation
"org.Hs.eg.db",    # Human gene annotation
"EnhancedVolcano", # Volcano plots
"enrichplot"       # Enrichment plotting
)
install_missing_pkgs(pkgs)
library("WGCNA")
pkgs <- c(
"tidyverse",     # Contains multiple packages for general tidiness
"magrittr",      # Pipe-friendly helpers
"dtplyr",        # data.table backend for dplyr
"textshaping",   # Text shaping for graphics devices
"impute",        #WGNCA dependency
"preprocessCore",#WGCNA dependency
"WGCNA",         # Weighted Gene Coexpression Network Analysis
"RColorBrewer",  # Color palettes
"ggplot2",       # Plotting (also in tidyverse)
"pheatmap",      # Heatmaps
"ggrepel",       # Text repel
"svglite",       # Save SVGs
"GOplot",        # GO chord plotting
"patchwork",      # Combine ggplots
"DESeq2",          # Differential Expression Analysis
"GO.db",           # Human gene annotation/enrichplot dependency
"org.Hs.eg.db",    # Human gene annotation
"EnhancedVolcano", # Volcano plots
"enrichplot"       # Enrichment plotting
)
install_missing_pkgs(pkgs)
```
# Set wd, check for required packages and load necessary libraries
setwd("C:/Users/z5259217/OneDrive - UNSW/Desktop/GitHub/HRECs-AMD-Cytokine-RNASeq")
install_missing_pkgs <- function(pkgs) {
to_install <- setdiff(pkgs, installed.packages()) #identify what to install
if (!requireNamespace("BiocManager", quietly = TRUE, dependencies = TRUE)) {
install.packages("BiocManager", repos = "https://cloud.r-project.org")
}
cran_catalog <- rownames(available.packages())
#bioc_catalog <- BiocManager::available() not needed as cran is smaller
is_cran <- to_install %in% cran_catalog
#is_bioc <- to_install %in% bioc_catalog not needed as cran is smaller
cran_pkgs <- to_install[is_cran]
bioc_pkgs <- setdiff(to_install, cran_pkgs)
if(length(cran_pkgs)){
install.packages(cran_pkgs, quiet = TRUE)
message("Installing packages: ", paste(to_install, collapse = ", "))
} else {
message("All CRAN packages already installed.")
}
if(length(bioc_pkgs)){
BiocManager::install(bioc_pkgs, quietly = TRUE, dependencies = TRUE)
message("Installing packages: ", paste(to_install, collapse = ", "))
} else {
message("All bioconductor packages already installed.")
}
load_pkgs <- sapply(pkgs, require, character.only = TRUE, quietly = TRUE)
load_fail <- names(load_pkgs)[!load_pkgs]
if(length(load_fail)) {
message("Some packages failed to load: ", paste(load_fail, collapse = ", "))
}else{
return("All packages loaded successfully.")
}
}
pkgs <- c(
"tidyverse",     # Contains multiple packages for general tidiness
"magrittr",      # Pipe-friendly helpers
"dtplyr",        # data.table backend for dplyr
"textshaping",   # Text shaping for graphics devices
"impute",        #WGNCA dependency
"preprocessCore",#WGCNA dependency
"WGCNA",         # Weighted Gene Coexpression Network Analysis
"RColorBrewer",  # Color palettes
"ggplot2",       # Plotting (also in tidyverse)
"pheatmap",      # Heatmaps
"ggrepel",       # Text repel
"svglite",       # Save SVGs
"GOplot",        # GO chord plotting
"patchwork",      # Combine ggplots
"DESeq2",          # Differential Expression Analysis
"GO.db",           # Human gene annotation/enrichplot dependency
"org.Hs.eg.db",    # Human gene annotation
"EnhancedVolcano", # Volcano plots
"enrichplot"       # Enrichment plotting
)
install_missing_pkgs(pkgs) #if any packages fail to load, you may need to add more packages due to dependency updates
set.seed(12345)
#rm(list = ls(all.names = TRUE)) unhash to clear environment
#gc() unhash to clear cache
options(max.print = .Machine$integer.max, scipen = 999, stringsAsFactors = F, dplyr.summarise.inform = F) #sets integer limit to max
library(tidyverse) #contains multiple packages for general tidiness
library(magrittr) #package adding useful functions for pipe operator
library(dtplyr) #package adding useful functions for pipe operator
library(textshaping)
set.seed(12345)
in_path <- "raw_data/" #set input path from working directory
out_path = "significant_data/" # set output path from working directory
Counts <-read.delim(paste0(in_path,"raw_counts.csv"), header = TRUE, row.names = 1, sep = ",")
Counts <- as.matrix(Counts[,1:48])
head(Counts)
#saveRDS(dds, file= paste0(in_path,name,"dds.RDS"))  #unhash to save RDS
Counts <-read.delim(paste0(in_path,"raw_counts.csv"), header = TRUE, row.names = 1, sep = ",")
Counts <- as.matrix(Counts[,1:48])
head(Counts)
#Possible comparison types: all_groups, fibro, inflam, angio, single *IF SINGLE MUST ALSO IDENTIFY TREATMENT*
metadatapicker <- function(comparisontype, treatment = NULL){
if(comparisontype == "important"){
condition <- factor(c(rep("Control", 6), rep("TGFb2", 6), rep("TNFa", 6), rep("Thrombin", 6), rep("ALL", 6)))
coldata <- data.frame(condition)
coldata$condition <- relevel(coldata$condition, ref = "Control")
# All Condition ---------------------------------------------------------
}else if (comparisontype == "all"){
condition <- factor(c(rep("Control", 6), rep("TGFb1", 6), rep("TGFb2", 6), rep("TNFa", 6), rep("Thrombin", 6) , rep("IL6", 6), rep("VEGF", 6), rep("ALL", 6)))
coldata <- data.frame(condition)
coldata$condition <- relevel(coldata$condition, ref = "Control")
# Fibro Condition ---------------------------------------------------------
}else if (comparisontype == "fibro"){
condition <- factor(c(rep("Control", 6), rep("TGFb1", 6), rep("TGFb2", 6), rep("TNFa", 6), rep("Thrombin", 6)))
coldata <- data.frame(condition)
coldata$condition <- relevel(coldata$condition, ref = "Control")
# Inflam Condition --------------------------------------------------------
}else if (comparisontype == "inflam"){
condition <- factor(c(rep("Control", 6), rep("TGFb1", 6), rep("TNFa", 6), rep("Thrombin", 6) , rep("IL6", 6)))
coldata <- data.frame(condition)
coldata$condition <- relevel(coldata$condition, ref = "Control")
# Angio Condition ---------------------------------------------------------
}else if (comparisontype == "angio"){
condition <- factor(c(rep("Control", 6), rep("TGFb2", 6), rep("Thrombin", 6) ,rep("VEGF", 6)))
coldata <- data.frame(condition)
coldata$condition <- relevel(coldata$condition, ref = "Control")
# Individuals only (no cocktail) ---------------------------------------------------------
}else if (comparisontype == "individuals"){
condition <- factor(c(rep("Control", 6), rep("TGFb1", 6), rep("TGFb2", 6), rep("TNFa", 6), rep("Thrombin", 6) , rep("IL6", 6), rep("VEGF", 6)))
coldata <- data.frame(condition)
coldata$condition <- relevel(coldata$condition, ref = "Control")
# Single Comparison Condition ---------------------------------------------
}else if (comparisontype == "single"){
if(!is.null(treatment)){
condition <- factor(c(rep("Control", 6), rep(treatment, 6)))
coldata <- data.frame(condition)
coldata$condition <- relevel(coldata$condition, ref = "Control")
}else{
print("Please select a treatment for your single comparison. Returning only Control group in data frame")
}
}else{
print("Invalid selection. Please choose from the list of possible comparisons.")
return(NULL)
}
return(list("condition" = condition, "coldata" = coldata,"name"= paste0(comparisontype,"_",treatment)))
}
library(pheatmap)
cytokines <- c("ALL","TNFa","Thrombin","TGFb2") #set treatments
red2blue <- colorRampPalette(c("#2066b4", "#ffffff", "#b4182a"))(100) #set colour scale
pheno_list <- list() #open an empty list outside of for loop
for (cytokine in cytokines) {
res_means <-read.delim(paste0("significant_data/",cytokine,"_deg_table_1L2FC_nobaseMean_cutoff_004.csv"),
header = TRUE, row.names = 1, sep = ",")%>%
mutate_all(~replace(., .=="", "no")) # read in DEGs and remove blanks
potential_targets <- read.delim(paste0("reference_data/",phenotype,"_Genecard_5.0relevance.csv"), header = TRUE, sep = ",") %>%
as.data.frame() #read in filter list
pheno_list[[cytokine]] <- merge(res_means, potential_targets, by.x = "symbol", by.y = "Gene.Symbol") #transect DEG and filter list
print(paste0(cytokine," ", phenotype," filtered list generated")) #print message to show it worked
#write.csv(pheno_list[[cytokine]], file = paste0(out_path,cytokine,"_",phenotype,"_filtered_genes_1L2FC.csv")) # write out a csv
}
res_means <-read.delim(paste0("significant_data/",cytokine,"_deg_table_1L2FC_nobaseMean_cutoff_004.csv"),
header = TRUE, row.names = 1, sep = ",")%>%
mutate_all(~replace(., .=="", "no")) # read in DEGs and remove blanks
cytokine = "ALL"
res_means <-read.delim(paste0("significant_data/",cytokine,"_deg_table_1L2FC_nobaseMean_cutoff_004.csv"),
header = TRUE, row.names = 1, sep = ",")%>%
mutate_all(~replace(., .=="", "no")) # read in DEGs and remove blanks
potential_targets <- read.delim(paste0("reference_data/cocktail_drug_target_screen_with_percentiles"), header = TRUE, sep = ",") %>%
as.data.frame() #read in filter list
potential_targets <- read.delim(paste0("reference_data/cocktail_drug_target_screen_with_percentiles.csv"), header = TRUE, sep = ",") %>%
as.data.frame() #read in filter list
potential_targets <- read.delim(paste0("reference_data/cocktail_drug_target_screen_with_percentiles.csv"), header = TRUE, sep = ",") %>%
as.data.frame() #read in filter list
potential_targets <- read.delim(paste0("reference_data/cocktail_drug_target_screen_with_percentiles.csv"), header = TRUE, sep = ",") %>%
as.data.frame() #read in filter list
potential_targets <- potential_targets %>%
filter(GSE13592 == 1)
pheno_list[[cytokine]] <- merge(res_means, potential_targets, by.x = "symbol", by.y = "gene") #transect DEG and filter list
print(paste0(cytokine," filtered list generated")) #print message to show it worked
cytokines <- c("ALL","TNFa","Thrombin","TGFb2") #set treatments
red2blue <- colorRampPalette(c("#2066b4", "#ffffff", "#b4182a"))(100) #set colour scale
pheno_list <- list() #open an empty list outside of for loop
for (cytokine in cytokines) {
res_means <-read.delim(paste0("significant_data/",cytokine,"_deg_table_1L2FC_nobaseMean_cutoff_004.csv"),
header = TRUE, row.names = 1, sep = ",")%>%
mutate_all(~replace(., .=="", "no")) # read in DEGs and remove blanks
potential_targets <- read.delim(paste0("reference_data/cocktail_drug_target_screen_with_percentiles.csv"), header = TRUE, sep = ",") %>%
as.data.frame() #read in filter list
potential_targets <- potential_targets %>%
filter(GSE13592 == 1)
pheno_list[[cytokine]] <- merge(res_means, potential_targets, by.x = "symbol", by.y = "gene") #transect DEG and filter list
print(paste0(cytokine," filtered list generated")) #print message to show it worked
#write.csv(pheno_list[[cytokine]], file = paste0(out_path,cytokine,"_",phenotype,"_filtered_genes_1L2FC.csv")) # write out a csv
}
heat <- lapply(pheno_list, function(cyto) {
row.names(cyto) <- cyto$symbol #pheatmap must have gene names in rownames
cyto$log2FoldChange <- as.numeric(cyto$log2FoldChange) #select only l2FC values
cyto %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
})
names(heat) <- names(pheno_list) #carry over names
heatmaps <- lapply(names(heat), function(cyto) {
p <- pheatmap(heat[[cyto]],
kmeans_k = NA,
breaks = seq(-3, 3, length.out = 101),
scale = "none",
cluster_rows = TRUE,
cluster_cols = FALSE,
clustering_distance_rows = "maximum",  # Corrected parameter name
clustering_method = "complete",
color = red2blue,
show_colnames = FALSE,
fontsize = 14)
#ggsave(filename = paste0(out_path, cyto, "_", phenotype, "_DEGs_001.svg"), plot = p[[4]], width = 15, height = (nrow(heat[[cyto]]) * 0.5), units = "cm")
})
names(heatmaps) <- names(heat)
pheno_overlap <- Reduce(function(x, y) merge(x, y, by = "symbol", all = TRUE), pheno_list)
pheno_overlap <- pheno_overlap %>% # as the reduce function generates replicate names,
setNames(make.unique(names(.)))  # we have to manually change them to be unique
heat_overlap <- pheno_overlap %>%
dplyr::select(3,18,33,48)  %>%
rename_with(~ c("ALL","TNFa", "Thrombin", "TGFb2")) %>%
mutate_all(~replace(., is.na(.), 0)) %>%
mutate(across(everything(), as.numeric)) %>%
as.matrix
rownames(heat_overlap) <-pheno_overlap$symbol
p_over <- pheatmap(heat_overlap,
kmeans_k = NA,
breaks = seq(-3, 3, length.out = 101),
scale = "none",
cluster_rows = TRUE,
cluster_cols = FALSE,
clustering_distance_rows = "euclidean",  # Corrected parameter name
clustering_method = "median",
color = red2blue,
show_colnames = TRUE,
fontsize = 14)
cytokines <- c("ALL") #set treatments
red2blue <- colorRampPalette(c("#2066b4", "#ffffff", "#b4182a"))(100) #set colour scale
pheno_list <- list() #open an empty list outside of for loop
for (cytokine in cytokines) {
res_means <-read.delim(paste0("significant_data/",cytokine,"_deg_table_1L2FC_nobaseMean_cutoff_004.csv"),
header = TRUE, row.names = 1, sep = ",")%>%
mutate_all(~replace(., .=="", "no")) # read in DEGs and remove blanks
potential_targets <- read.delim(paste0("reference_data/cocktail_drug_target_screen_with_percentiles.csv"), header = TRUE, sep = ",") %>%
as.data.frame() #read in filter list
potential_targets <- potential_targets %>%
filter(GSE13592 == 1)
pheno_list[[cytokine]] <- merge(res_means, potential_targets, by.x = "symbol", by.y = "gene") #transect DEG and filter list
print(paste0(cytokine," filtered list generated")) #print message to show it worked
#write.csv(pheno_list[[cytokine]], file = paste0(out_path,cytokine,"_",phenotype,"_filtered_genes_1L2FC.csv")) # write out a csv
}
heat <- lapply(pheno_list, function(cyto) {
row.names(cyto) <- cyto$symbol #pheatmap must have gene names in rownames
cyto$log2FoldChange <- as.numeric(cyto$log2FoldChange) #select only l2FC values
cyto %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
})
names(heat) <- names(pheno_list) #carry over names
heatmaps <- lapply(names(heat), function(cyto) {
p <- pheatmap(heat[[cyto]],
kmeans_k = NA,
breaks = seq(-3, 3, length.out = 101),
scale = "none",
cluster_rows = TRUE,
cluster_cols = FALSE,
clustering_distance_rows = "maximum",  # Corrected parameter name
clustering_method = "complete",
color = red2blue,
show_colnames = FALSE,
fontsize = 14)
#ggsave(filename = paste0(out_path, cyto, "_", phenotype, "_DEGs_001.svg"), plot = p[[4]], width = 15, height = (nrow(heat[[cyto]]) * 0.5), units = "cm")
})
names(heatmaps) <- names(heat)
pheno_overlap <- Reduce(function(x, y) merge(x, y, by = "symbol", all = TRUE), pheno_list)
pheno_overlap <- pheno_overlap %>% # as the reduce function generates replicate names,
setNames(make.unique(names(.)))  # we have to manually change them to be unique
heat_overlap <- pheno_overlap %>%
dplyr::select(3,18,33,48)  %>%
rename_with(~ c("ALL","TNFa", "Thrombin", "TGFb2")) %>%
mutate_all(~replace(., is.na(.), 0)) %>%
mutate(across(everything(), as.numeric)) %>%
as.matrix
rownames(heat_overlap) <-pheno_overlap$symbol
p_over <- pheatmap(heat_overlap,
kmeans_k = NA,
breaks = seq(-3, 3, length.out = 101),
scale = "none",
cluster_rows = TRUE,
cluster_cols = FALSE,
clustering_distance_rows = "euclidean",  # Corrected parameter name
clustering_method = "median",
color = red2blue,
show_colnames = TRUE,
fontsize = 14)
heat <- lapply(pheno_list, function(cyto) {
row.names(cyto) <- cyto$symbol #pheatmap must have gene names in rownames
cyto$log2FoldChange <- as.numeric(cyto$log2FoldChange) #select only l2FC values
cyto %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
})
names(heat) <- names(pheno_list) #carry over names
heatmaps <- lapply(names(heat), function(cyto) {
p <- pheatmap(heat[[cyto]],
kmeans_k = NA,
breaks = seq(-3, 3, length.out = 101),
scale = "none",
cluster_rows = TRUE,
cluster_cols = FALSE,
clustering_distance_rows = "maximum",  # Corrected parameter name
clustering_method = "complete",
color = red2blue,
show_colnames = FALSE,
fontsize = 14)
#ggsave(filename = paste0(out_path, cyto, "_", phenotype, "_DEGs_001.svg"), plot = p[[4]], width = 15, height = (nrow(heat[[cyto]]) * 0.5), units = "cm")
})
ggsave(filename = paste0(out_path, cytokine,"_scRNAFiltered_DEGs_001.svg"), plot = p_over[[4]], width = 15, height = (3 + (nrow(heat[[cyto]]) * 0.5)), units = "cm")
for (cytokine in cytokines) {
res_means <-read.delim(paste0("significant_data/",cytokine,"_deg_table_1L2FC_nobaseMean_cutoff_004.csv"),
header = TRUE, row.names = 1, sep = ",")%>%
mutate_all(~replace(., .=="", "no")) # read in DEGs and remove blanks
potential_targets <- read.delim(paste0("reference_data/cocktail_drug_target_screen_with_percentiles.csv"), header = TRUE, sep = ",") %>%
as.data.frame() #read in filter list
potential_targets <- potential_targets %>%
filter(GSE13592 == 1)
pheno_list[[cytokine]] <- merge(res_means, potential_targets, by.x = "symbol", by.y = "gene") #transect DEG and filter list
print(paste0(cytokine," filtered list generated")) #print message to show it worked
#write.csv(pheno_list[[cytokine]], file = paste0(out_path,cytokine,"_",phenotype,"_filtered_genes_1L2FC.csv")) # write out a csv
}
heat <- lapply(pheno_list, function(cyto) {
row.names(cyto) <- cyto$symbol #pheatmap must have gene names in rownames
cyto$log2FoldChange <- as.numeric(cyto$log2FoldChange) #select only l2FC values
cyto %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
})
names(heat) <- names(pheno_list) #carry over names
heatmaps <- lapply(names(heat), function(cyto) {
p <- pheatmap(heat[[cyto]],
kmeans_k = NA,
breaks = seq(-3, 3, length.out = 101),
scale = "none",
cluster_rows = TRUE,
cluster_cols = FALSE,
clustering_distance_rows = "maximum",  # Corrected parameter name
clustering_method = "complete",
color = red2blue,
show_colnames = FALSE,
fontsize = 14)
#ggsave(filename = paste0(out_path, cyto, "_", phenotype, "_DEGs_001.svg"), plot = p[[4]], width = 15, height = (nrow(heat[[cyto]]) * 0.5), units = "cm")
})
names(heatmaps) <- names(heat)
pheno_overlap <- Reduce(function(x, y) merge(x, y, by = "symbol", all = TRUE), pheno_list)
heat_overlap <- pheno_overlap %>%
dplyr::select(3,18,33,48)  %>%
rename_with(~ c("ALL","TNFa", "Thrombin", "TGFb2")) %>%
mutate_all(~replace(., is.na(.), 0)) %>%
mutate(across(everything(), as.numeric)) %>%
as.matrix
pheno_overlap <- pheno_overlap %>% # as the reduce function generates replicate names,
setNames(make.unique(names(.)))  # we have to manually change them to be unique
heat_overlap <- pheno_overlap %>%
dplyr::select(3,18,33,48)  %>%
rename_with(~ c("ALL","TNFa", "Thrombin", "TGFb2")) %>%
mutate_all(~replace(., is.na(.), 0)) %>%
mutate(across(everything(), as.numeric)) %>%
as.matrix
View(heat)
p <- pheatmap(heat[[cyto]],
kmeans_k = NA,
breaks = seq(-3, 3, length.out = 101),
scale = "none",
cluster_rows = TRUE,
cluster_cols = FALSE,
clustering_distance_rows = "maximum",  # Corrected parameter name
clustering_method = "complete",
color = red2blue,
show_colnames = FALSE,
fontsize = 14)
p <- pheatmap(heat[["ALL"]],
kmeans_k = NA,
breaks = seq(-3, 3, length.out = 101),
scale = "none",
cluster_rows = TRUE,
cluster_cols = FALSE,
clustering_distance_rows = "maximum",  # Corrected parameter name
clustering_method = "complete",
color = red2blue,
show_colnames = FALSE,
fontsize = 14)
ggsave(filename = paste0(out_path,"scRNAFiltered_DEGs_001.svg"), plot = p[[4]], width = 15, height = (nrow(heat[[cyto]]) * 0.5), units = "cm")
ggsave(filename = paste0(out_path,"scRNAFiltered_DEGs_001.svg"), plot = p[[4]], width = 15, height = (nrow(heat[["ALL"]]) * 0.5), units = "cm")
ggsave(filename = paste0(out_path,"scRNAFiltered_DEGs_001.svg"), plot = p[[4]], width = 10, height = (nrow(heat[["ALL"]]) * 0.5), units = "cm")
ggsave(filename = paste0(out_path,"scRNAFiltered_DEGs_001.svg"), plot = p[[4]], width = 10, height = (nrow(heat[["ALL"]]) * 0.5), units = "cm", limitsize = FALSE)
merged_dat <- merge(res_means, potential_targets, by.x = "symbol", by.y = "gene") #transect DEG and filter list
print(paste0(cytokine," filtered list generated")) #print message to show it worked
heat <- function(cyto) {
row.names(cyto) <- cyto$symbol #pheatmap must have gene names in rownames
cyto$log2FoldChange <- as.numeric(cyto$log2FoldChange) #select only l2FC values
cyto %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
})
heat <- function(cyto) {
row.names(cyto) <- cyto$symbol #pheatmap must have gene names in rownames
cyto$log2FoldChange <- as.numeric(cyto$log2FoldChange) #select only l2FC values
cyto %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
}
heat <- lapply(merged_dat, function(cyto) {
row.names(cyto) <- cyto$symbol #pheatmap must have gene names in rownames
cyto$log2FoldChange <- as.numeric(cyto$log2FoldChange) #select only l2FC values
cyto %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
})
heat <- apply(merged_dat, function(cyto) {
row.names(cyto) <- cyto$symbol #pheatmap must have gene names in rownames
cyto$log2FoldChange <- as.numeric(cyto$log2FoldChange) #select only l2FC values
cyto %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
})
heat <- sapply(merged_dat, function(cyto) {
row.names(cyto) <- cyto$symbol #pheatmap must have gene names in rownames
cyto$log2FoldChange <- as.numeric(cyto$log2FoldChange) #select only l2FC values
cyto %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
})
heat <- merged_dat
row.names(heat) <- heat$symbol #pheatmap must have gene names in rownames
heat$log2FoldChange <- as.numeric(heat$log2FoldChange) #select only l2FC values
heat %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
heat <- merged_dat
row.names(heat) <- heat$symbol #pheatmap must have gene names in rownames
heat$log2FoldChange <- as.numeric(heat$log2FoldChange) #select only l2FC values
heat <- heat %>%
dplyr::select(log2FoldChange) %>% #select only symbols
na.omit()
names(heat) <- names(merged_dat) #carry over names
p <- pheatmap(heat,
kmeans_k = NA,
breaks = seq(-3, 3, length.out = 101),
scale = "none",
cluster_rows = TRUE,
cluster_cols = FALSE,
clustering_distance_rows = "maximum",  # Corrected parameter name
clustering_method = "complete",
color = red2blue,
show_colnames = FALSE,
fontsize = 14)
ggsave(filename = paste0(out_path,"scRNAFiltered_DEGs_002.svg"), plot = p[[4]], width = 10, height = (nrow(heat) * 0.5), units = "cm", limitsize = FALSE)
